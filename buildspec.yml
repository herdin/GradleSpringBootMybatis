version: 0.2

#env:
#  variables:
#    CURRENT: date +"%Y%m%d%H%M%S"

phases:
  build:
    commands:
      - export CURRENT=$(date +"%Y%m%d%H%M%S")
      - echo "build time tag is $CURRENT"
      - echo "boot jar build start at $(date +"%Y-%m-%d %H:%M:%S")"
      - chmod +x ./gradlew
      - ./gradlew bootJar
#      - ./gradlew build
      - echo "docker images build start at $(date +"%Y-%m-%d %H:%M:%S")"
      - echo "$(docker --version)"
      - docker build -t msa.example:$CURRENT .
      - echo "build end"
  post_build:
    commands:
      - echo "post build start"
#      - echo "bootJar -> $(ls -al ./build/libs/)"
#      - echo "docker images -> $(docker images)"
      - echo "post build end"

cache:
  paths:
    - '/root/.gradle/caches/**/*'