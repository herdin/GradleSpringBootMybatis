<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MSA prototype - user</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<!--    <link rel="stylesheet" href="/static/css/pure-min.css" />-->
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.1/build/pure-min.css" crossorigin="anonymous">
</head>
<body>
<div id="app">
    <div class="container">
        <div class="col-md-6 offset-md-3">
            <h1 class="text-center mb-4">User Card Management.</h1>
            <input type="text" class="form-control mb-4" v-model="newCardNo" @keyup.enter="addNewCard"/>
            <div class="list-group mb-4">
                <template v-for="card in cardList">
                    <div class="btn-toolbar mb-3" role="toolbar" aria-label="Toolbar with button groups">
                        <div class="input-group mr-3">
                            <input type="text" class="form-control" :value="card.cardNo"/>
                        </div>
                        <div class="btn-group mr-2" role="group" aria-label="First group">
                            <button type="button" class="btn btn-warning" @click="gotoTransaction(card.cardNo)">transaction</button>
                            <button type="button" class="btn btn-primary" @click="modifyCardNo(card.cardNo)">modify</button>
                            <button type="button" class="btn btn-danger" @click="deleteCardNo(card.cardNo)">delete</button>
                        </div>
                    </div>
                </template>
            </div>
            <table class="mx-auto pure-table">
                <thead>
                    <tr>
                        <td>11</td>
                        <td>22</td>
                        <td>33</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td>데이터 없음</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>


<script src="/static/js/common.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.js"></script>
<!--<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js"></script>-->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
    new Vue({
        el: '#app',
        data: {
            newCardNo: '',
            cardList: [],
            // [
            //     {
            //         "userId": "s.jo0701",
            //         "cardNo": "1010000100010001",
            //         "cardStaNm": "Active",
            //         "cardPrdId": "001",
            //         "cardPrdNm": "Tmoney",
            //         "cardPrdCrgNm": "Tmoney"
            //     },
            //     {
            //         "userId": "s.jo0701",
            //         "cardNo": "1010000100010004",
            //         "cardStaNm": "Active",
            //         "cardPrdId": "003",
            //         "cardPrdNm": "Mobile Tmoney",
            //         "cardPrdCrgNm": "Mobile Tmoney"
            //     },
            //     {
            //         "userId": "s.jo0701",
            //         "cardNo": "1010000100010002",
            //         "cardStaNm": "Active",
            //         "cardPrdId": "002",
            //         "cardPrdNm": "Shinhan Tmoney",
            //         "cardPrdCrgNm": "Alliance Tmoney"
            //     }
            // ],
            transList: [],
        },
        computed: {
        },
        mounted: function () {
            let self = this;
            axios({
                method: 'get',
                url: api.url + 'user/card',
                data: {
                }
            })
            .then(function(response){
                console.log('then response -> ');
                console.dir(response);
                if(response.data != null && response.data.length > 0) {
                    self.cardList = response.data;
                }
            })
            .catch(function(response) {
                console.log('catch response -> ');
                console.log(response);
            })
            ;
        },//mounted
        methods: {
            addNewCard: function() {
                console.log('new card no -> ' + this.newCardNo);
                let self = this;

                if(!/^[\d]{16}$/.test(self.newCardNo)) {
                    swal("Card Number is must be 16 digit!", "...", "error");
                } else if(this.cardList.filter(card => card.cardNo == self.newCardNo).length > 0) {
                    swal("Already got that!", "card is already registered.", "error");
                } else {
                    axios({
                        method: 'put',
                        url: api.url + 'user/card',
                        data: {
                            cardNo: self.newCardNo
                        }
                    })
                    .then(function(response){
                        console.log('then response -> ');
                        console.log(response);
                    })
                    .catch(function(response) {
                        console.log('catch response -> ');
                        console.log(response);
                    })
                    ;
                    this.cardList.push({ cardNo: self.newCardNo});
                }
            },
            gotoTransaction: function(cardNo) {
                axios({
                    method: 'get',
                    url: api.url + 'user/card/' + cardNo + '/trans',
                    data: {
                    }
                })
                .then(function(response){
                    console.log('then response -> ');
                    console.log(response);
                })
                .catch(function(response) {
                    console.log('catch response -> ');
                    console.log(response);
                })
                ;
                window.location = api.url + 'user/card/' + cardNo + '/trans';
            },
            modifyCardNo: function (cardNo) {

            },
            deleteCardNo: function (cardNo) {

            },
        },//methods
    });
</script>
</body>
</html>